# 01 为什么选择 Recoil 而不是 Redux/MobX ？

在讨论究竟该选择哪个 状态管理库 之前，我们先说一下为什么 React 需要状态管理。



<br>

## React为什么需要状态管理？

假设我们现在要开发这样一个页面：

1. 页面有一个侧边栏
2. 在距离这个侧边栏很远的地方有一个按钮，点击该按钮可以隐藏侧边栏

为了实现这个效果，我们可能需要在页面中定义一个 isSidebarOpen 的变量，通过修改该变量的值为 true 或 false 来记录和决定是否显示或隐藏侧边栏。



<br>

换句话说，我们的应用程序的状态是由一些数据或变量决定的。

**项目中的这些变量在哪定义、如何储存、如何修改，我们可以称为 `数据管理`，而这些 数据 的变动影响着应用程序的状态，所以我们把对 数据的管理 称呼为 `状态管理`。**



<br>

> 请注意，我们这里说的 `数据管理` `状态管理` 是一种综合、高层次的概念，并不是指具体的变量如何定义，例如使用 useState、useContext、useReducer 等。



<br>

这些数据(变量)：

1. 有可能在组件内部定义，且储存在组件内部
2. 也有可能在第三方状态管理中心定义和储存

<br>

通过对应用程序状态(数据)的管理，实现了我们应用程序数据请求、用户操作等交互效果。



<br>

## 常见的状态管理方式



#### 第1种：使用 useState + useContext + useReducer

我们可以使用 useState 在组件内部定义变量，还可以通过 useContext + useReducer 实现跨级传递变量。

这种方式存在以下 2 个问题：

1. 问题1：随着变量数量的增加，我们需要投入更多的心智，花费更多的精力。
2. 问题2：尽管 useContext + useReducer 可以实现组件跨级传递，但是我们必须小心使用它，这个模式下最大的隐患就是性能，因为当 useContext 中某个变量发生变化时，有可能会引发所有子项都重新渲染。



这个时候，第三方状态库出现了。

<br>

#### 第2种：使用 Redux

Redux 是最早一批 React 第三方状态库，也是目前使用最多的。

Redux 遵循函数式编程风格，强调通过纯函数来实现数据的管理。

**优点：**

1. Redux 诞生于 2015 年
2. 有丰富的官方文档 和 社区生态
3. 文件体积小，约 3K
4. 还有很多基于 Redux 开发的其他周边生态库

<br>

**缺点：**

1. 学习成本非常大，简单来说就是比较难学，难易掌握
2. 读写数据时，需要严格按照他规定的范式来进行，可能会让人用起来不爽
3. Redux 诞生比较早，这样意味着它的历史负担比较重，需要兼顾各个 React 历史版本



<br>

#### 第3种：使用 MobX

MobX 属于后起之秀，也是非常流行的一个第三方状态库，与 Redux 的函数式编程思想不同，MobX 则采用传统面对对象中的 观察模式，通过创建一个可观察的数据模型，将组件设想成 “观察者”，加上内部使用 ES6 的代理类(Proxy)，实现 = 赋值运算。

**优点：**

1. 数据逻辑更加清晰明了
2. 读写方式相较于 Redux 更加简单方便

**缺点：**

1. 需要先定义数据模型结构

   > 你可以想象成 MySql 数据库那样，需要先建表结构

2. 没有 Redux 那样丰富的社区支持

3. 过于灵活的数据操作也意味着有时容易让代码不够明确



<br>

#### 第4种：使用 MobX State Tree (MST)

和 MobX 类似，做了一些改进。



<br>

除此之外，还有其他一些状态库，例如 XState 等，不再过多介绍。



<br>

#### 补充：React-Query

react-query 并不算是状态管理库，它是用来管理数据网络请求的。

之所以这里也要提一下它，是因为状态管理中本身就有一部分工作是围绕 数据加载、缓存数据管理等操作。



<br>

终于，新的主角要出现了。

## 新一代状态管理库：Recoil

![p0](https://puxiao.com/temp/recoil-tutorial/imgs/p0.jpg)

Recoil 状态库开源于 2020 年 5 月，由 Facebook 的 React 开发人员创建的新一代 React 状态管理库。

尽管目前从严格意义上来讲 Recoil 依然属于 “React第三方状态库”，但实际 Recoil 却是堂堂正正具有 React 官方背景的。



<br>

假设你是一名 React Hooks 使用者，你肯定能够明白 类组件 与 函数组件的差距，Hooks 可以让我们的项目具有多么灵活的逻辑拆分能力。

<br>

同样，Recoil 与其他状态库(Redux、MobX、MST) 的差距也是如此巨大。



<br>

回答本文最初的问题。

#### 为什么选择 Recoil 而不是 Redux/MobX ？

* **理由1：Recoil 是由 React 开发人员创造的，具有官方背景**
* **理由2：Recoil 专门针对 Hooks 的函数组件，更加简单、灵活、高效**
* **理由3：学习成本低，减轻心智负担，用起来爽**



<br>

是时候该抛弃 Redux、MobX 了，让我们拥抱 Recoil ！



<br>

#### 对 Redux 的嘲讽

如果你有梯子，你可以在 YouTube 上看一下 React 核心开发人员 Ben 对于 Redux 的吐槽视频。

https://www.youtube.com/watch?v=BhQYZmaxTCM

<br>

**在该视频结尾处，Ben 幽幽的说了这么一段话：**

“在你的职业生涯中可能会遇到 Redux，因此你需要某个时候去学习 Redux，但是我希望你尽量拖延。无论如何，对于哪些最终还是要使用 Redux 的人，我祝你一切顺利。切记对 Redux 要非常小心，不要让你的代码看起来像...我的头发这样凌乱。”

![p1](https://puxiao.com/temp/recoil-tutorial/imgs/p1.jpg)



> 实际上我曾经也想尝试学习过 Redux，但是被他们的官方文档吓退了，感觉好难。



<br>

下一节，我们将开始正式投入到 Recoil 的学习中，先从 Recoil 的原理讲起。